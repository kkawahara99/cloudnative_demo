#!/bin/bash -eu

# ------------------------------------------------------- #
# ログ管理
# ------------------------------------------------------- #
source ./util/log_manager.sh

# ------------------------------------------------------- #
# 引数チェック
# ------------------------------------------------------- #
if [ $# != 2 ]; then
    echo 引数エラー: $* 1>&2
    exit 1
fi

# ------------------------------------------------------- #
# 変数定義
# ------------------------------------------------------- #
export SYSTEM_NAME=$1
export ENV_NAME=$2
export STACK_LIST=./stack-list

# ------------------------------------------------------- #
# 関数インポート
# ------------------------------------------------------- #
source ./util/deploy_stack.sh

# ------------------------------------------------------- #
# Main
# ------------------------------------------------------- #
# 説明：
# stack-listの上から順にスタックをデプロイする
# ------------------------------------------------------- #
for line in `echo "$(cat ${STACK_LIST})"`
do
  # デプロイ
  deploy_stack $line
done

exit